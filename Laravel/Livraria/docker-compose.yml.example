version: '3'

services:
  dbmaster:
    container_name: dbmaster
    hostname: dbmaster
    restart: on-failure
    image: zhcdsan/mysqlmaster:8.0
#    build:
#      context: ./.docker/build/mysql/master/
    ports:
      - 13306:3306
    volumes:
      - dbmastervolume:/var/lib/mysql
    environment:
      MYSQL_ROOT_PASSWORD: mypass
      MYSQL_USER: masteruser
      MYSQL_PASSWORD: masterpass
      MYSQL_ALLOW_EMPTY_PASSWORD: 'yes'
    networks:
      - dbnetwork

  dbslave:
    container_name: dbslave
    hostname: dbslave
    restart: on-failure
    image: zhcdsan/mysqlslave:8.0
#    build:
#      context: ./.docker/build/mysql/slave/
    ports:
      - 13307:3306
    volumes:
      - dbslavevolume:/var/lib/mysql
    environment:
      MYSQL_ROOT_PASSWORD: mypass
      MYSQL_USER: slaveuser
      MYSQL_PASSWORD: slavepass
      MYSQL_ALLOW_EMPTY_PASSWORD: 'yes'
    depends_on:
      - dbmaster
    networks:
      - dbnetwork

  dbmasterslave:
    container_name: dbmasterslave
    image: zhcdsan/mysqlmasterslave:8.0
#    build:
#      context: ./.docker/build/mysql/masterslave/
    depends_on:
      - dbmaster
      - dbslave
    networks:
      - dbnetwork
  # PHP (with Nginx)
  # you can change from nginx to apache, just change session 'image'
  app:
    image: ambientum/php:7.2-nginx
    container_name: livraria-app
    volumes:
      - .:/var/www/app
    ports:
      - 18080:8080
    links:
      - dbmaster
      - dbslave
    networks:
      - dbnetwork

networks:
  dbnetwork:
    driver: bridge

volumes:
  dbmastervolume:
    driver: local
  dbslavevolume:
    driver: local
